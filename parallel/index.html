
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="An educational content generation toolkit powered by Google's Gemini LLM. Transform raw text into structured, well-organized educational courses with minimal effort.">
      
      
        <meta name="author" content="Sheepbear">
      
      
        <link rel="canonical" href="https://supersheepbear.github.io/GeminiTeacher/parallel/">
      
      
        <link rel="prev" href="../modules/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Parallel Processing - GeminiTeacher</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#parallel-processing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="GeminiTeacher" class="md-header__button md-logo" aria-label="GeminiTeacher" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GeminiTeacher
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Parallel Processing
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/supersheepbear/GeminiTeacher" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    supersheepbear/GeminiTeacher
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="GeminiTeacher" class="md-nav__button md-logo" aria-label="GeminiTeacher" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    GeminiTeacher
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/supersheepbear/GeminiTeacher" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    supersheepbear/GeminiTeacher
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Code Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Code Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Parallel Processing
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Parallel Processing
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Key Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parallel_generate_chapters" class="md-nav__link">
    <span class="md-ellipsis">
      parallel_generate_chapters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate_chapter_with_retry" class="md-nav__link">
    <span class="md-ellipsis">
      generate_chapter_with_retry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel_map_with_delay" class="md-nav__link">
    <span class="md-ellipsis">
      parallel_map_with_delay
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#progressive-file-saving" class="md-nav__link">
    <span class="md-ellipsis">
      Progressive File Saving
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-rate-limits-consideration" class="md-nav__link">
    <span class="md-ellipsis">
      API Rate Limits Consideration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Rate Limits Consideration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recommended-settings-for-google-gemini-api" class="md-nav__link">
    <span class="md-ellipsis">
      Recommended Settings for Google Gemini API
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Core Functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geminiteacher.parallel.parallel_generate_chapters" class="md-nav__link">
    <span class="md-ellipsis">
      parallel_generate_chapters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="parallel_generate_chapters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.parallel_generate_chapters--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.parallel_generate_chapters--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geminiteacher.parallel.generate_chapter_with_retry" class="md-nav__link">
    <span class="md-ellipsis">
      generate_chapter_with_retry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="generate_chapter_with_retry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.generate_chapter_with_retry--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.generate_chapter_with_retry--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.generate_chapter_with_retry--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geminiteacher.parallel.parallel_map_with_delay" class="md-nav__link">
    <span class="md-ellipsis">
      parallel_map_with_delay
    </span>
  </a>
  
    <nav class="md-nav" aria-label="parallel_map_with_delay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.parallel_map_with_delay--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.parallel_map_with_delay--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.parallel_map_with_delay--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Considerations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-course-generator" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Course Generator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Limitations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      Future Enhancements
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Key Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parallel_generate_chapters" class="md-nav__link">
    <span class="md-ellipsis">
      parallel_generate_chapters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate_chapter_with_retry" class="md-nav__link">
    <span class="md-ellipsis">
      generate_chapter_with_retry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel_map_with_delay" class="md-nav__link">
    <span class="md-ellipsis">
      parallel_map_with_delay
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#progressive-file-saving" class="md-nav__link">
    <span class="md-ellipsis">
      Progressive File Saving
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-rate-limits-consideration" class="md-nav__link">
    <span class="md-ellipsis">
      API Rate Limits Consideration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Rate Limits Consideration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recommended-settings-for-google-gemini-api" class="md-nav__link">
    <span class="md-ellipsis">
      Recommended Settings for Google Gemini API
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Core Functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geminiteacher.parallel.parallel_generate_chapters" class="md-nav__link">
    <span class="md-ellipsis">
      parallel_generate_chapters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="parallel_generate_chapters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.parallel_generate_chapters--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.parallel_generate_chapters--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geminiteacher.parallel.generate_chapter_with_retry" class="md-nav__link">
    <span class="md-ellipsis">
      generate_chapter_with_retry
    </span>
  </a>
  
    <nav class="md-nav" aria-label="generate_chapter_with_retry">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.generate_chapter_with_retry--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.generate_chapter_with_retry--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.generate_chapter_with_retry--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geminiteacher.parallel.parallel_map_with_delay" class="md-nav__link">
    <span class="md-ellipsis">
      parallel_map_with_delay
    </span>
  </a>
  
    <nav class="md-nav" aria-label="parallel_map_with_delay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.parallel_map_with_delay--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.parallel_map_with_delay--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geminiteacher.parallel.parallel_map_with_delay--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Considerations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-course-generator" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Course Generator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Limitations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      Future Enhancements
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="parallel-processing">Parallel Processing<a class="headerlink" href="#parallel-processing" title="Permanent link">&para;</a></h1>
<p>The <code>parallel</code> module provides tools for parallel execution of tasks with controlled API rate limiting and robust error handling. This module is particularly useful for accelerating the chapter generation process while respecting API rate limits.</p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The parallel processing capabilities include:</p>
<ol>
<li><strong>Controlled Parallel Execution</strong>: Execute tasks in parallel with configurable workers</li>
<li><strong>Rate Limit Management</strong>: Add randomized delays between API requests to avoid rate limits</li>
<li><strong>Robust Error Handling</strong>: Automatically retry failed requests with exponential backoff</li>
<li><strong>Ordered Results</strong>: Ensure outputs are returned in the same order as inputs, regardless of completion time</li>
<li><strong>Progressive File Saving</strong>: Each chapter is saved to disk as soon as it's generated, preventing data loss</li>
</ol>
<h2 id="key-functions">Key Functions<a class="headerlink" href="#key-functions" title="Permanent link">&para;</a></h2>
<h3 id="parallel_generate_chapters">parallel_generate_chapters<a class="headerlink" href="#parallel_generate_chapters" title="Permanent link">&para;</a></h3>
<p>The main orchestration function that handles parallel generation of course chapters:</p>
<pre><code class="language-python">import geminiteacher as gt
from geminiteacher.parallel import parallel_generate_chapters

# Define chapter titles to generate
chapter_titles = [
    &quot;Introduction to Machine Learning&quot;,
    &quot;Supervised Learning Algorithms&quot;,
    &quot;Unsupervised Learning Techniques&quot;
]

# Generate chapters in parallel
chapters = parallel_generate_chapters(
    chapter_titles=chapter_titles,
    content=&quot;Your raw content here&quot;,
    max_workers=4,              # Number of parallel workers (processes)
    delay_range=(0.2, 0.8),     # Random delay between API requests in seconds
    max_retries=3,              # Number of retry attempts for failed requests
    course_title=&quot;ML_Course&quot;,   # Title for saved files
    output_dir=&quot;courses&quot;        # Directory to save generated chapters
)

# Process the generated chapters
for i, chapter in enumerate(chapters):
    print(f&quot;Chapter {i+1}: {chapter.title}&quot;)
</code></pre>
<h3 id="generate_chapter_with_retry">generate_chapter_with_retry<a class="headerlink" href="#generate_chapter_with_retry" title="Permanent link">&para;</a></h3>
<p>A robust wrapper around the standard <code>generate_chapter</code> function that adds retry logic:</p>
<pre><code class="language-python">import geminiteacher as gt
from geminiteacher.parallel import generate_chapter_with_retry

# Generate a single chapter with retry logic
chapter = generate_chapter_with_retry(
    chapter_title=&quot;Introduction to Neural Networks&quot;,
    content=&quot;Your raw content here&quot;,
    max_retries=3,              # Maximum number of retry attempts
    retry_delay=1.0             # Base delay between retries (will increase exponentially)
)

print(f&quot;Chapter title: {chapter.title}&quot;)
print(f&quot;Summary: {chapter.summary[:100]}...&quot;)
</code></pre>
<h3 id="parallel_map_with_delay">parallel_map_with_delay<a class="headerlink" href="#parallel_map_with_delay" title="Permanent link">&para;</a></h3>
<p>A generic function for applying any function to a list of items in parallel with controlled delays:</p>
<pre><code class="language-python">from geminiteacher.parallel import parallel_map_with_delay
import time

# Define a function to execute in parallel
def process_item(item, prefix=&quot;Item&quot;):
    # Simulate some work
    time.sleep(0.5)
    return f&quot;{prefix}: {item}&quot;

# Items to process
items = [&quot;apple&quot;, &quot;banana&quot;, &quot;cherry&quot;, &quot;date&quot;, &quot;elderberry&quot;]

# Process items in parallel with controlled delays
results = parallel_map_with_delay(
    func=process_item,
    items=items,
    max_workers=3,              # Number of parallel workers
    delay_range=(0.1, 0.5),     # Random delay between task submissions
    prefix=&quot;Processed&quot;          # Additional parameter passed to process_item
)

# Results are in the same order as the input items
for item, result in zip(items, results):
    print(f&quot;Original: {item} → Result: {result}&quot;)
</code></pre>
<h2 id="progressive-file-saving">Progressive File Saving<a class="headerlink" href="#progressive-file-saving" title="Permanent link">&para;</a></h2>
<p>A key feature of the parallel processing module is its ability to save chapters to disk as they are generated. This provides several benefits:</p>
<ol>
<li><strong>Data Safety</strong>: Even if the process is interrupted, completed chapters are already saved</li>
<li><strong>Progress Tracking</strong>: You can monitor progress by watching files appear in the output directory</li>
<li><strong>Immediate Access</strong>: Start reviewing early chapters while later ones are still being generated</li>
</ol>
<p>Example of how files are saved:</p>
<pre><code class="language-python">import geminiteacher as gt

course = gt.create_course_parallel(
    content=&quot;Your content here&quot;,
    course_title=&quot;Data_Science&quot;,
    output_dir=&quot;my_courses&quot;
)

# Files will be saved in a structure like:
# my_courses/
#   └── Data_Science/
#       ├── chapter_01_Introduction_to_Data_Science.md
#       ├── chapter_02_Data_Collection_and_Cleaning.md
#       └── chapter_03_Exploratory_Data_Analysis.md
</code></pre>
<p>Each chapter file contains the structured content with title, summary, explanation, and extension sections.</p>
<h2 id="api-rate-limits-consideration">API Rate Limits Consideration<a class="headerlink" href="#api-rate-limits-consideration" title="Permanent link">&para;</a></h2>
<p>When working with external APIs like Google's Gemini, rate limits are an important consideration. The <code>parallel</code> module helps manage these limits through controlled submission timing:</p>
<ol>
<li><strong>Random Delays</strong>: Adds a configurable random delay between API requests to avoid overwhelming the API</li>
<li><strong>Exponential Backoff</strong>: When retrying failed requests, uses exponential backoff to gradually increase wait times</li>
<li><strong>Configurable Workers</strong>: Allows limiting the number of concurrent processes to respect API parallelism limits</li>
</ol>
<h3 id="recommended-settings-for-google-gemini-api">Recommended Settings for Google Gemini API<a class="headerlink" href="#recommended-settings-for-google-gemini-api" title="Permanent link">&para;</a></h3>
<p>For the Google Gemini API, the following settings work well for most scenarios:</p>
<ul>
<li><strong><code>max_workers</code></strong>: 2-6 (depending on your API tier)</li>
<li><strong><code>delay_range</code></strong>: (0.2, 1.0) seconds</li>
<li><strong><code>max_retries</code></strong>: 3</li>
</ul>
<p>These settings balance speed with API reliability. For higher API tiers with more generous rate limits, you can increase <code>max_workers</code> and decrease the delay range.</p>
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<p>The parallel module implements comprehensive error handling:</p>
<ol>
<li><strong>Retries for Empty Responses</strong>: Automatically retries when the API returns empty content</li>
<li><strong>Exception Recovery</strong>: Catches and handles API errors with automatic retries</li>
<li><strong>Fallback Content</strong>: If all retries fail, returns a structured error message instead of failing completely</li>
</ol>
<p>This ensures robustness even when dealing with unreliable network conditions or API instability.</p>
<h2 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h2>
<h3 id="core-functions">Core Functions<a class="headerlink" href="#core-functions" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-function">



<a id="geminiteacher.parallel.parallel_generate_chapters"></a>
    <div class="doc doc-contents first">

        <p>Generate multiple chapters in parallel with retry logic and rate limiting.</p>
<p>This function orchestrates the parallel generation of multiple chapters,
handling API rate limits and retrying failed requests. Each chapter is
saved to disk as soon as it's generated.</p>
<h3 id="geminiteacher.parallel.parallel_generate_chapters--parameters">Parameters<a class="headerlink" href="#geminiteacher.parallel.parallel_generate_chapters--parameters" title="Permanent link">&para;</a></h3>
<p>chapter_titles : List[str]
    List of chapter titles to generate.
content : str
    The raw content to use for generating chapters.
llm : Optional[BaseLanguageModel], optional
    The language model to use. If None, a default model will be configured.
temperature : float, optional
    The temperature setting for generation. Default is 0.0.
custom_prompt : Optional[str], optional
    Custom instructions to append to the chapter generation prompt.
max_workers : Optional[int], optional
    Maximum number of worker processes. If None, uses the default.
delay_range : tuple, optional
    Range (min, max) in seconds for the random delay between task submissions.
    Default is (0.1, 0.5).
max_retries : int, optional
    Maximum number of retry attempts per chapter. Default is 3.
course_title : str, optional
    Title of the course for saving files. Default is "course".
output_dir : str, optional
    Directory to save the chapter files. Default is "output".</p>
<h3 id="geminiteacher.parallel.parallel_generate_chapters--returns">Returns<a class="headerlink" href="#geminiteacher.parallel.parallel_generate_chapters--returns" title="Permanent link">&para;</a></h3>
<p>List[ChapterContent]
    List of generated chapter contents in the same order as the input titles.</p>


            <details class="quote">
              <summary>Source code in <code>src\geminiteacher\parallel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parallel_generate_chapters</span><span class="p">(</span>
    <span class="n">chapter_titles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">llm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseLanguageModel</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">custom_prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_workers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">delay_range</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">course_title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;course&quot;</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;output&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ChapterContent</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate multiple chapters in parallel with retry logic and rate limiting.</span>

<span class="sd">    This function orchestrates the parallel generation of multiple chapters,</span>
<span class="sd">    handling API rate limits and retrying failed requests. Each chapter is</span>
<span class="sd">    saved to disk as soon as it&#39;s generated.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    chapter_titles : List[str]</span>
<span class="sd">        List of chapter titles to generate.</span>
<span class="sd">    content : str</span>
<span class="sd">        The raw content to use for generating chapters.</span>
<span class="sd">    llm : Optional[BaseLanguageModel], optional</span>
<span class="sd">        The language model to use. If None, a default model will be configured.</span>
<span class="sd">    temperature : float, optional</span>
<span class="sd">        The temperature setting for generation. Default is 0.0.</span>
<span class="sd">    custom_prompt : Optional[str], optional</span>
<span class="sd">        Custom instructions to append to the chapter generation prompt.</span>
<span class="sd">    max_workers : Optional[int], optional</span>
<span class="sd">        Maximum number of worker processes. If None, uses the default.</span>
<span class="sd">    delay_range : tuple, optional</span>
<span class="sd">        Range (min, max) in seconds for the random delay between task submissions.</span>
<span class="sd">        Default is (0.1, 0.5).</span>
<span class="sd">    max_retries : int, optional</span>
<span class="sd">        Maximum number of retry attempts per chapter. Default is 3.</span>
<span class="sd">    course_title : str, optional</span>
<span class="sd">        Title of the course for saving files. Default is &quot;course&quot;.</span>
<span class="sd">    output_dir : str, optional</span>
<span class="sd">        Directory to save the chapter files. Default is &quot;output&quot;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[ChapterContent]</span>
<span class="sd">        List of generated chapter contents in the same order as the input titles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;geminiteacher.parallel&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting parallel generation of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chapter_titles</span><span class="p">)</span><span class="si">}</span><span class="s2"> chapters with </span><span class="si">{</span><span class="n">max_workers</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span><span class="si">}</span><span class="s2"> workers&quot;</span><span class="p">)</span>

    <span class="c1"># Get API key from the LLM if provided or environment</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;gemini-1.5-pro&quot;</span>

    <span class="k">if</span> <span class="n">llm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Try to extract API key and model name from the provided LLM</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># This assumes LLM is a ChatGoogleGenerativeAI instance</span>
            <span class="n">api_key</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="s2">&quot;google_api_key&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">model_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using model: </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Could not extract API key from provided LLM, will use environment variables&quot;</span><span class="p">)</span>

    <span class="c1"># Create a list of (index, chapter_title) tuples to preserve order</span>
    <span class="n">indexed_titles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">chapter_titles</span><span class="p">))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using delay range: </span><span class="si">{</span><span class="n">delay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">delay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">s between tasks&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving chapters progressively to </span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">course_title</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>

    <span class="c1"># Generate chapters in parallel with delay between submissions and save each one as it completes</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">parallel_map_with_delay</span><span class="p">(</span>
        <span class="n">_worker_generate_and_save_chapter</span><span class="p">,</span>
        <span class="n">indexed_titles</span><span class="p">,</span>
        <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">,</span>
        <span class="n">delay_range</span><span class="o">=</span><span class="n">delay_range</span><span class="p">,</span>
        <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
        <span class="n">course_title</span><span class="o">=</span><span class="n">course_title</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
        <span class="n">custom_prompt</span><span class="o">=</span><span class="n">custom_prompt</span><span class="p">,</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span>
        <span class="n">retry_delay</span><span class="o">=</span><span class="mf">1.0</span>
    <span class="p">)</span>

    <span class="c1"># Extract just the chapter content from the results (idx, chapter, file_path)</span>
    <span class="n">chapters</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Completed parallel generation of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chapters</span><span class="p">)</span><span class="si">}</span><span class="s2"> chapters&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">chapters</span> 
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="geminiteacher.parallel.generate_chapter_with_retry"></a>
    <div class="doc doc-contents first">

        <p>Generate a chapter with retry logic for handling API failures.</p>
<p>This function wraps the generate_chapter function with retry logic to handle
transient API errors, timeouts, or empty responses.</p>
<h3 id="geminiteacher.parallel.generate_chapter_with_retry--parameters">Parameters<a class="headerlink" href="#geminiteacher.parallel.generate_chapter_with_retry--parameters" title="Permanent link">&para;</a></h3>
<p>chapter_title : str
    The title of the chapter to generate.
content : str
    The raw content to use for generating the chapter.
llm : Optional[BaseLanguageModel], optional
    The language model to use. If None, a default model will be configured.
temperature : float, optional
    The temperature setting for generation. Default is 0.0.
custom_prompt : Optional[str], optional
    Custom instructions to append to the chapter generation prompt.
max_retries : int, optional
    Maximum number of retry attempts. Default is 3.
retry_delay : float, optional
    Base delay between retries in seconds. Default is 1.0.</p>
<h3 id="geminiteacher.parallel.generate_chapter_with_retry--returns">Returns<a class="headerlink" href="#geminiteacher.parallel.generate_chapter_with_retry--returns" title="Permanent link">&para;</a></h3>
<p>ChapterContent
    The generated chapter content.</p>
<h3 id="geminiteacher.parallel.generate_chapter_with_retry--notes">Notes<a class="headerlink" href="#geminiteacher.parallel.generate_chapter_with_retry--notes" title="Permanent link">&para;</a></h3>
<p>This function implements an exponential backoff strategy for retries,
with each retry attempt waiting longer than the previous one.</p>


            <details class="quote">
              <summary>Source code in <code>src\geminiteacher\parallel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_chapter_with_retry</span><span class="p">(</span>
    <span class="n">chapter_title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">llm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseLanguageModel</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">custom_prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">retry_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChapterContent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a chapter with retry logic for handling API failures.</span>

<span class="sd">    This function wraps the generate_chapter function with retry logic to handle</span>
<span class="sd">    transient API errors, timeouts, or empty responses.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    chapter_title : str</span>
<span class="sd">        The title of the chapter to generate.</span>
<span class="sd">    content : str</span>
<span class="sd">        The raw content to use for generating the chapter.</span>
<span class="sd">    llm : Optional[BaseLanguageModel], optional</span>
<span class="sd">        The language model to use. If None, a default model will be configured.</span>
<span class="sd">    temperature : float, optional</span>
<span class="sd">        The temperature setting for generation. Default is 0.0.</span>
<span class="sd">    custom_prompt : Optional[str], optional</span>
<span class="sd">        Custom instructions to append to the chapter generation prompt.</span>
<span class="sd">    max_retries : int, optional</span>
<span class="sd">        Maximum number of retry attempts. Default is 3.</span>
<span class="sd">    retry_delay : float, optional</span>
<span class="sd">        Base delay between retries in seconds. Default is 1.0.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ChapterContent</span>
<span class="sd">        The generated chapter content.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function implements an exponential backoff strategy for retries,</span>
<span class="sd">    with each retry attempt waiting longer than the previous one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;geminiteacher.parallel&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating chapter &#39;</span><span class="si">{</span><span class="n">chapter_title</span><span class="si">}</span><span class="s2">&#39; (attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">max_retries</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="n">chapter</span> <span class="o">=</span> <span class="n">generate_chapter</span><span class="p">(</span>
                <span class="n">chapter_title</span><span class="o">=</span><span class="n">chapter_title</span><span class="p">,</span>
                <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                <span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span>
                <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
                <span class="n">custom_prompt</span><span class="o">=</span><span class="n">custom_prompt</span>
            <span class="p">)</span>

            <span class="c1"># Check if we got a valid response (non-empty explanation)</span>
            <span class="k">if</span> <span class="n">chapter</span><span class="o">.</span><span class="n">explanation</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully generated chapter &#39;</span><span class="si">{</span><span class="n">chapter_title</span><span class="si">}</span><span class="s2">&#39; (length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chapter</span><span class="o">.</span><span class="n">explanation</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars)&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">chapter</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Empty chapter explanation received&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span><span class="p">:</span>
                <span class="c1"># Calculate backoff with jitter</span>
                <span class="n">backoff</span> <span class="o">=</span> <span class="n">retry_delay</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">)</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Chapter generation failed for &#39;</span><span class="si">{</span><span class="n">chapter_title</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">max_retries</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Retrying in </span><span class="si">{</span><span class="n">backoff</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s...&quot;</span>
                <span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">backoff</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;All retry attempts failed for chapter &#39;</span><span class="si">{</span><span class="n">chapter_title</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Last error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="c1"># Return a basic chapter with error information</span>
                <span class="k">return</span> <span class="n">ChapterContent</span><span class="p">(</span>
                    <span class="n">title</span><span class="o">=</span><span class="n">chapter_title</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="s2">&quot;Error: Failed to generate chapter content after multiple attempts.&quot;</span><span class="p">,</span>
                    <span class="n">explanation</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;The chapter generation process encountered repeated errors: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;Please try regenerating this chapter or check your API configuration.&quot;</span>
                <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">



<a id="geminiteacher.parallel.parallel_map_with_delay"></a>
    <div class="doc doc-contents first">

        <p>Execute a function on multiple items in parallel with a delay between submissions.</p>
<p>This function uses ProcessPoolExecutor to parallelize the execution of a function
across multiple items, while introducing a random delay between task submissions
to avoid overwhelming external APIs with simultaneous requests.</p>
<h3 id="geminiteacher.parallel.parallel_map_with_delay--parameters">Parameters<a class="headerlink" href="#geminiteacher.parallel.parallel_map_with_delay--parameters" title="Permanent link">&para;</a></h3>
<p>func : Callable[..., T]
    The function to execute in parallel.
items : List[Any]
    The list of items to process.
max_workers : Optional[int], optional
    Maximum number of worker processes. If None, uses the default
    (typically the number of CPU cores).
delay_range : tuple, optional
    Range (min, max) in seconds for the random delay between task submissions.
    Default is (0.1, 0.5).
**kwargs
    Additional keyword arguments to pass to the function.</p>
<h3 id="geminiteacher.parallel.parallel_map_with_delay--returns">Returns<a class="headerlink" href="#geminiteacher.parallel.parallel_map_with_delay--returns" title="Permanent link">&para;</a></h3>
<p>List[T]
    List of results in the same order as the input items.</p>
<h3 id="geminiteacher.parallel.parallel_map_with_delay--examples">Examples<a class="headerlink" href="#geminiteacher.parallel.parallel_map_with_delay--examples" title="Permanent link">&para;</a></h3>
<blockquote>
<blockquote>
<blockquote>
<p>def process_item(item, factor=1):
...     return item * factor
items = [1, 2, 3, 4, 5]
results = parallel_map_with_delay(process_item, items, factor=2)
print(results)
[2, 4, 6, 8, 10]</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="quote">
              <summary>Source code in <code>src\geminiteacher\parallel.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parallel_map_with_delay</span><span class="p">(</span>
    <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">],</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
    <span class="n">max_workers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">delay_range</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute a function on multiple items in parallel with a delay between submissions.</span>

<span class="sd">    This function uses ProcessPoolExecutor to parallelize the execution of a function</span>
<span class="sd">    across multiple items, while introducing a random delay between task submissions</span>
<span class="sd">    to avoid overwhelming external APIs with simultaneous requests.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func : Callable[..., T]</span>
<span class="sd">        The function to execute in parallel.</span>
<span class="sd">    items : List[Any]</span>
<span class="sd">        The list of items to process.</span>
<span class="sd">    max_workers : Optional[int], optional</span>
<span class="sd">        Maximum number of worker processes. If None, uses the default</span>
<span class="sd">        (typically the number of CPU cores).</span>
<span class="sd">    delay_range : tuple, optional</span>
<span class="sd">        Range (min, max) in seconds for the random delay between task submissions.</span>
<span class="sd">        Default is (0.1, 0.5).</span>
<span class="sd">    **kwargs</span>
<span class="sd">        Additional keyword arguments to pass to the function.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[T]</span>
<span class="sd">        List of results in the same order as the input items.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; def process_item(item, factor=1):</span>
<span class="sd">    ...     return item * factor</span>
<span class="sd">    &gt;&gt;&gt; items = [1, 2, 3, 4, 5]</span>
<span class="sd">    &gt;&gt;&gt; results = parallel_map_with_delay(process_item, items, factor=2)</span>
<span class="sd">    &gt;&gt;&gt; print(results)</span>
<span class="sd">    [2, 4, 6, 8, 10]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;geminiteacher.parallel&quot;</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">total_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

    <span class="c1"># Export the current log level to the environment for worker processes</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GeminiTeacher_LOG_LEVEL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">getEffectiveLevel</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="c1"># Submit all tasks with a delay between submissions</span>
        <span class="n">futures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
            <span class="c1"># Add a small random delay to avoid overwhelming the API</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">delay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">delay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Submitting task </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_items</span><span class="si">}</span><span class="s2"> with delay: </span><span class="si">{</span><span class="n">delay</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>

            <span class="c1"># Submit the task to the process pool</span>
            <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Submitted task </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_items</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Collect results in the original order</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">future</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Waiting for task </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_items</span><span class="si">}</span><span class="s2"> to complete&quot;</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Completed task </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_items</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_items</span><span class="si">}</span><span class="s2"> failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># Re-raise the exception to maintain the expected behavior</span>
                <span class="k">raise</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h2 id="performance-considerations">Performance Considerations<a class="headerlink" href="#performance-considerations" title="Permanent link">&para;</a></h2>
<p>When using parallel processing, consider the following to optimize performance:</p>
<ol>
<li><strong>CPU Cores</strong>: The optimal <code>max_workers</code> is typically close to the number of available CPU cores</li>
<li><strong>Memory Usage</strong>: Each worker process requires memory, so limit <code>max_workers</code> on memory-constrained systems</li>
<li><strong>API Rate Limits</strong>: Always respect API rate limits by adjusting <code>delay_range</code> and <code>max_workers</code></li>
<li><strong>Task Granularity</strong>: Parallel processing works best when individual tasks take significant time</li>
</ol>
<h2 id="integration-with-course-generator">Integration with Course Generator<a class="headerlink" href="#integration-with-course-generator" title="Permanent link">&para;</a></h2>
<p>The parallel module integrates seamlessly with the coursemaker module through the <code>create_course_parallel</code> function:</p>
<pre><code class="language-python">import geminiteacher as gt

# Generate a course using parallel processing
course = gt.create_course_parallel(
    &quot;Your raw content here&quot;,
    max_workers=4,
    delay_range=(0.2, 0.8),
    max_retries=3,
    course_title=&quot;Advanced_Topics&quot;,
    output_dir=&quot;output/courses&quot;
)

print(f&quot;Generated {len(course.chapters)} chapters in parallel&quot;)
</code></pre>
<h2 id="limitations">Limitations<a class="headerlink" href="#limitations" title="Permanent link">&para;</a></h2>
<ul>
<li>Increased memory usage compared to sequential processing</li>
<li>Potential for higher API costs due to faster request rates</li>
<li>Debugging can be more complex in parallel environments</li>
</ul>
<h2 id="future-enhancements">Future Enhancements<a class="headerlink" href="#future-enhancements" title="Permanent link">&para;</a></h2>
<p>Future versions may include:
- Adaptive rate limiting based on API response times
- Better telemetry for monitoring API usage
- Support for concurrent.futures.ThreadPoolExecutor for I/O-bound tasks
- Dynamic worker allocation based on system resources </p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Maintained by <a href="https://supersheepbear.com">supersheepbear</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/supersheepbear/GeminiTeacher" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/geminiteacher" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>